<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phân tích Học phần Giáo dục Quốc phòng - ĐH Đại Nam</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            white-space: nowrap;
            min-width: 150px;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transform: translateY(0);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th, td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }
        
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .analysis-text {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            margin: 20px 0;
            line-height: 1.6;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .recommendation {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .recommendation h4 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .recommendation ul {
            list-style: none;
            padding-left: 0;
        }
        
        .recommendation li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .recommendation li:before {
            content: "✓";
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .filter-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .filter-row {
            display: flex;
            gap: 20px;
            align-items: end;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }
        
        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .filter-select {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .filter-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        
        .export-btn {
            background: linear-gradient(135deg, #fd7e14 0%, #e83e8c 100%);
        }
        
        .no-data {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px;
        }
        
        .result-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .result-summary h4 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .summary-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .summary-number {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .input-group {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .input-field {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }
        
        .input-field label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .input-field input, .input-field select {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .input-field input:focus, .input-field select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .result-box {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .result-box h4 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .highlight {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 700;
        }
        
        .warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .schedule-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        
        .schedule-item h5 {
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎓 Phân tích Học phần Giáo dục Quốc phòng</h1>
            <p>Trường Đại học Đại Nam - Hệ thống quản lý và phân tích dữ liệu</p>
        </div>
        
        <div class="content">
            <div class="tabs">
                <div class="tab active" onclick="showTab('overview')">Tổng quan</div>
                <!-- <div class="tab" onclick="showTab('analysis')">Phân tích hiện tại</div> -->
                <div class="tab" onclick="showTab('charts')">Biểu đồ</div>
                <div class="tab" onclick="showTab('schedule')">Đề xuất lịch học</div>
                <div class="tab" onclick="showTab('calculator')">Tính toán đợt học & xếp lịch học </div>
                <!-- <div class="tab" onclick="showTab('statistics')">Thống kê theo năm</div> -->
                <!-- <div class="tab" onclick="showTab('filter')">Lọc & Xuất Excel</div> -->
            </div>
            
            <!-- Tab Tổng quan -->
        <div id="overview" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">22</div>
                        <div class="stat-label">Khoa trong trường</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">38-40</div>
                        <div class="stat-label">Tuần học khả dụng</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">3-4</div>
                        <div class="stat-label">Tuần/đợt học</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">400-600</div>
                        <div class="stat-label">SV/đợt học</div>
                    </div>
                      <div class="stat-card">
                        <div class="stat-number">28,300K</div>
                        <div class="stat-label">Sinh viên từ năm 2025-2028 cần học GDQP</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>📊 Thông tin cơ bản về học phần</h3>
                    <div class="analysis-text">
                        <p><strong>Học phần:</strong> Giáo dục Quốc phòng (bắt buộc cho tất cả sinh viên)</p>
                        <p><strong>Thời gian năm học:</strong> Tháng 8 năm nay → Tháng 7-8 năm sau</p>
                        <p><strong>Cấu trúc năm học:</strong> 52 tuần (12-14 tuần nghỉ/hoạt động khác + 38-40 tuần học)</p>
                        <p><strong>Quy mô đào tạo:</strong> 4,000 sinh viên/năm học</p>
                        <p><strong>Năm học 2024-2025:</strong> 11 đợt học đã được tổ chức</p>
                    </div>
                </div>
                
                <div class="card">
                    <h3>👥 Thông tin sinh viên các khóa</h3>
                    <div style="margin-bottom: 15px;">
                        <button class="btn export-btn" onclick="exportOverviewToExcel()">📊 Xuất Excel - Thông tin các khóa</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Khóa</th>
                                    <th>Tổng số SV</th>
                                    <th>SV hoàn thành 2024-2025</th>
                                    <th>Tỷ lệ hoàn thành</th>
                                    <th>Trạng thái</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Khóa 16</strong></td>
                                    <td>3,000</td>
                                    <td>400-600</td>
                                    <td>13-20%</td>
                                    <td>Gần hoàn thành</td>
                                </tr>
                                <tr>
                                    <td><strong>Khóa 17</strong></td>
                                    <td>5,300</td>
                                    <td>2000-3500</td>
                                    <td>72-100%</td>
                                    <td>Đang học chính</td>
                                </tr>
                                <tr>
                                    <td><strong>Khóa 18</strong></td>
                                    <td>6,000</td>
                                    <td>200-300</td>
                                    <td>3-5%</td>
                                    <td>Mới bắt đầu</td>
                                </tr>
                                <tr>
                                    <td><strong>Khóa 19</strong></td>
                                    <td>6,000-8,000</td>
                                    <td>0</td>
                                    <td>0%</td>
                                    <td>Sắp nhập học</td>
                                </tr>
                                <tr>
                                    <td><strong>Khóa 20</strong></td>
                                    <td>6,000-8,000</td>
                                    <td>0</td>
                                    <td>0%</td>
                                    <td>Sắp nhập học</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Tab Phân tích 
            <div id="analysis" > -->
                <div class="card">
                    <h3>🔍 Phân tích tình hình hiện tại</h3>
                    <div class="analysis-text">
                        <h4>1. Phân tích năm học 2024-2025:</h4>
                        <p>• <span class="highlight">11 đợt học</span> đã tổ chức với tổng cộng khoảng 4000-4500 sinh viên hoàn thành</p>
                        <p>• Khóa 17 chiếm tỷ trọng lớn nhất (86-86.4% tổng số sinh viên hoàn thành năm học)</p>
                        <p>• Có 1 đợt học chung giữa khóa 17 và khóa 18 </p>
                        
                        <h4>2. Tính toán số đợt cần thiết:</h4>
                        <p>• <strong>Tổng sinh viên cần học:</strong> 20,300-25,300 sinh viên (tất cả các khóa)</p>
                        <p>• <strong>Khả năng đào tạo/đợt:</strong> 400-600 sinh viên</p>
                        <p>• <strong>Số đợt cần thiết:</strong> 34-63 đợt (tùy theo quy mô mỗi đợt)</p>
                        <p>• <strong>Thời gian cần:</strong> 3-5 năm học để hoàn thành tất cả</p>
                        
                        <h4>3. Thách thức:</h4>
                        <p>• Số lượng sinh viên tăng mạnh từ khóa 17 trở đi</p>
                        <p>• Khả năng đào tạo hạn chế (chỉ 38-40 tuần/năm, 3-4 tuần/đợt)</p>
                        <p>• Cần tối ưu hóa việc xếp lịch để tăng hiệu quả</p>
                    </div>
                </div>

                
                <div class="recommendation">
                    <h4>💡 Đề xuất giải pháp:</h4>
                    <ul>
                        <li>Tăng quy mô mỗi đợt lên 600 sinh viên</li>
                        <li>Tổ chức 12-13 đợt/năm học thay vì 11 đợt</li>
                        <li>Ưu tiên hoàn thành khóa 16 trong năm 2024-2025, để hoàn thành trước thời gian thi tốt nghiệp và thời gian đi thực tập.</li>
                        <li>Xếp lịch hợp lý cho khóa 17, 18 trong các năm tiếp theo</li>
                        <li>Chuẩn bị sẵn kế hoạch cho khóa 19, 20</li>
                    </ul>
                </div>


                <!-- Tab Lọc & Xuất Excel -->
            <div id="filter" >
                <div class="card">
                    <h3>🔍 Lọc dữ liệu và xuất Excel</h3>
                    
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="courseSelect">Chọn khóa học:</label>
                                <select id="courseSelect" class="filter-select">
                                    <option value="">-- Tất cả khóa --</option>
                                    <option value="16">Khóa 16</option>
                                    <option value="17">Khóa 17</option>
                                    <option value="18">Khóa 18</option>
                                    <option value="19">Khóa 19</option>
                                    <option value="20">Khóa 20</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="yearSelect">Chọn năm học:</label>
                                <select id="yearSelect" class="filter-select">
                                    <option value="">-- Tất cả năm --</option>
                                    <option value="2022-2023">2022-2023</option>
                                    <option value="2023-2024">2023-2024</option>
                                    <option value="2024-2025">2024-2025</option>
                                    <option value="2025-2026">2025-2026</option>
                                    <option value="2026-2027">2026-2027</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <button class="btn filter-btn" onclick="applyFilter()">🔍 Lọc dữ liệu</button>
                                <button class="btn export-btn" onclick="exportToExcel()">📊 Xuất Excel</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>📋 Kết quả lọc</h3>
                    <div id="filterResults">
                        <p class="no-data">Vui lòng chọn điều kiện lọc và nhấn "Lọc dữ liệu" để xem kết quả.</p>
                    </div>
                </div>
            </div>
        </div>


            </div>
    </div>
            
            
            
            <!-- Tab Biểu đồ -->
     <div id="charts" class="tab-content">
                <!-- Stacked Chart 
                <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl shadow-lg p-6">-->
                <div class="card">
                    <h3> Dự đoán sinh viên hoàn thành theo khóa và năm </h3>
                    <div class="chart-container">
                        <canvas id="gdqpChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>📈 Biểu đồ phân tích</h3>
                    <div class="chart-container">
                        <canvas id="studentChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <h3>📊 Tiến độ hoàn thành theo khóa</h3>
                    <div class="chart-container">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <h3>📅 Dự báo số đợt cần thiết</h3>
                    <div class="chart-container"> 
                        <canvas id="forecastChart"></canvas>
                    </div>
                </div>


                 <!-- Tab Thống kê -->
            <div>
                <div class="card">
                    <h3>📊 Thống kê sinh viên hoàn thành theo năm học</h3>
                    <div style="margin-bottom: 15px;">
                        <button class="btn export-btn" onclick="exportStatisticsToExcel()">📊 Xuất Excel - Thống kê theo năm</button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Khóa</th>
                                    <th>2022-2023</th>
                                    <th>2023-2024</th>
                                    <th>2024-2025</th>
                                    <th>2025-2026</th>
                                    <th>2026-2027</th>
                                    <th>2027-2028</th>
                                    <th>Tổng</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Khóa 16</strong></td>
                                    <td>1,200</td>
                                    <td>1,707</td>
                                    <td>953</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>3,000</td>
                                </tr>
                                <tr>
                                    <td><strong>Khóa 17</strong></td>
                                    <td>-</td>
                                    <td>2,164</td>
                                    <td>2,682</td>
                                    <td>454</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>5,300</td>
                                </tr>
                                <tr>
                                    <td><strong>Khóa 18</strong></td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>127</td>
                                    <td>2,850</td>
                                    <td>3000</td>
                                    <td>-</td>
                                    <td>6,000</td>
                                </tr>
                                <tr>
                                    <td><strong>Khóa 19</strong></td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>1,034</td>
                                    <td>1,333</td>
                                    <td>1,333</td>
                                    <td>6,000</td>
                                </tr>
                                <tr>
                                    <td><strong>Khóa 20</strong></td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>1,334</td>
                                    <td>1,333</td>
                                    <td>7,000</td>
                                </tr>
                                <tr style="background: #f8f9fa; font-weight: bold;">
                                    <td><strong>Tổng/năm</strong></td>
                                    <td>-</td>
                                    <td>3,871</td>
                                    <td>3,873</td>
                                    <td>4,338</td>
                                    <td>5,667</td>
                                    <td>-</td>
                                    <td>28,300</td>
                                </tr>
                            </tbody>
                        </table>
                        <br>
                        <p>Chú thích: k14 học gộp một khóa với k17 năm học 2024-2025 </p>
                    </div>
                    
                    <div class="analysis-text">
                        <h4>Ghi chú về dữ liệu:</h4>
                        <p>• Số liệu năm 2022-2023 và 2023-2024 cho khóa 16 được tính toán dựa trên tổng số 3,000 sinh viên</p>
                        <p>• Khóa 17 bắt đầu từ năm 2023-2024 với số lượng nhỏ, chủ yếu hoàn thành trong 2024-2025</p>
                        <p>• Khóa 18 mới bắt đầu trong 2024-2025, sẽ hoàn thành chủ yếu trong 2025-2026</p>
                        <p>• Khóa 19 và 20 được dự báo với quy mô 7,000 sinh viên mỗi khóa</p>
                    </div>
                </div>
                
                <div class="card">
                    <h3>📈 Xu hướng tăng trưởng</h3>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>

        </div>
            
            
            <!-- Tab Đề xuất lịch học -->
            <div id="schedule" class="tab-content">
                <div class="card">
                    <h3>📅 Đề xuất lịch học hợp lý</h3>
                    
                    <h4>Năm học 2024-2025 (còn lại), quy mô 600 sinh viên/ đợt:</h4>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Đợt</th>
                                    <th>Thời gian</th>
                                    <th>Khóa</th>
                                    <th>Số SV</th>
                                    <th>Ghi chú</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Đợt 12</td>
                                    <td>Tháng 4-5/2025</td>
                                    <td>Khóa 17</td>
                                    <td>600</td>
                                    <td>Hoàn thành khóa 17</td>
                                </tr>
                                <tr>
                                    <td>Đợt 13</td>
                                    <td>Tháng 6-7/2025</td>
                                    <td>Khóa 18</td>
                                    <td>600</td>
                                    <td>Bổ sung khóa 18</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h4>Năm học 2025-2026:</h4>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Đợt</th>
                                    <th>Thời gian</th>
                                    <th>Khóa</th>
                                    <th>Số SV</th>
                                    <th>Mục tiêu</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1-4</td>
                                    <td>Tháng 8-12/2025</td>
                                    <td>Khóa 18</td>
                                    <td>2,400</td>
                                    <td>Ưu tiên khóa 18</td>
                                </tr>
                                <tr>
                                    <td>5-8</td>
                                    <td>Tháng 1-4/2026</td>
                                    <td>Khóa 18</td>
                                    <td>2,400</td>
                                    <td>Tiếp tục khóa 18</td>
                                </tr>
                                <tr>
                                    <td>9-12</td>
                                    <td>Tháng 5-7/2026</td>
                                    <td>Khóa 19</td>
                                    <td>2,400</td>
                                    <td>Bắt đầu khóa 19</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>   
            
<!-- Tab Tính toán -->
            <div id="calculator" class="tab-content">
                <div class="card">
                    <h3>🧮 Tính toán số đợt và tuần học 2025-2028</h3>
                    
                    <div class="input-group">
                        <div class="input-field">
                            <label>Số sinh viên cần học:</label>
                            <input type="number" id="totalStudents" value="20250" min="1">
                        </div>
                        <div class="input-field">
                            <label>Sinh viên/đợt:</label>
                            <input type="number" id="studentsPerBatch" value="600" min="100" max="1000">
                        </div>
                        <div class="input-field">
                            <label>Tuần/đợt:</label>
                            <input type="number" id="weeksPerBatch" value="3" min="2" max="5">
                        </div>
                        <div class="input-field">
                            <label>Tuần học/năm:</label>
                            <input type="number" id="weeksPerYear" value="38" min="30" max="45">
                        </div>
                        <div class="input-field">
                            <button class="btn" onclick="calculateBatches()">📊 Tính toán</button>
                        </div>
                    </div>
                    
                    <div id="calculationResult"></div>
                </div>
                
                <div class="card">
                    <h3>📈 Phân bổ theo khóa</h3>
                    
                    <div class="input-group">
                        <div class="input-field">
                            <label>Chọn khóa:</label>
                            <select id="CourseSelect">
                                <option value="16">Khóa 16 (500 SV còn lại)</option>
                                <option value="17">Khóa 17 (500 SV còn lại)</option>
                                <option value="18">Khóa 18 (5,750 SV còn lại)</option>
                                <option value="19">Khóa 19 (7,000 SV còn lại)</option>
                                <option value="20">Khóa 20 (7,000 SV còn lại)</option>
                            </select>
                        </div>
                        <div class="input-field">
                            <label>Ưu tiên (1-5):</label>
                            <input type="number" id="priority" value="1" min="1" max="5">
                        </div>
                        <div class="input-field">
                            <button class="btn" onclick="calculateCourse()">🎯 Tính cho khóa</button>
                        </div>
                    </div>
                    
                    <div id="courseResult"></div>
                </div>

 <!-- Tab Xếp lịch -->
            <div>
                <div class="card">
                    <h3>📅 Xếp lịch học tự động</h3>
                    
                    <div class="input-group">
                        <div class="input-field">
                            <label>Năm học bắt đầu:</label>
                            <select id="startYear">
                                <option value="2024">2024-2025</option>
                                <option value="2025">2025-2026</option>
                                <option value="2026">2026-2027</option>
                            </select>
                        </div>
                        <div class="input-field">
                            <label>Số đợt tối đa/năm:</label>
                            <input type="number" id="maxBatchesPerYear" value="12" min="8" max="15">
                        </div>
                        <div class="input-field">
                            <label>Chiến lược xếp lịch:</label>
                            <select id="strategy">
                                <option value="priority">Ưu tiên khóa cũ</option>
                                <option value="balanced">Cân bằng các khóa</option>
                                <option value="capacity">Tối ưu công suất</option>
                            </select>
                        </div>
                        <div class="input-field">
                            <button class="btn" onclick="generateSchedule()">🗓️ Tạo lịch học</button>
                        </div>
                    </div>
                    
                    <div id="scheduleResult"></div>
                </div>
                
                <div class="card">
                    <h3>📊 Xuất kế hoạch</h3>
                    <button class="btn" onclick="exportSchedule()">📄 Xuất Excel</button>
                    <button class="btn" onclick="exportSummary()">📋 Xuất tóm tắt</button>
                </div>
            </div>
        </div>

            




    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Initialize charts when charts tab is shown
            if (tabName === 'charts') {
                setTimeout(initCharts, 100);
            }
           // if (tabName === 'statistics') {
           //     setTimeout(initTrendChart, 100);
           // }
        }
        
        // Initialize charts CÁC THỂ LOẠI BIỂU ĐỒ
        function initCharts() {
            // Student distribution chart
            const ctx1 = document.getElementById('studentChart').getContext('2d');
            if (ctx1) {
                new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: ['Khóa 16', 'Khóa 17', 'Khóa 18', 'Khóa 19', 'Khóa 20'],
                        datasets: [{
                            label: 'Tổng số sinh viên',
                            data: [3000, 5300, 6000, 7000, 7000],
                            backgroundColor: 'rgba(102, 126, 234, 0.8)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 2
                        }, {
                            label: 'Đã hoàn thành 2024-2025',
                            data: [500, 4500, 250, 0, 0],
                            backgroundColor: 'rgba(40, 167, 69, 0.8)',
                            borderColor: 'rgba(40, 167, 69, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Phân bố sinh viên theo khóa'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            // Progress chart
            const ctx2 = document.getElementById('progressChart');
            if (ctx2) {
                new Chart(ctx2, {
                    type: 'doughnut',
                    data: {
                        labels: ['Khóa 16', 'Khóa 17', 'Khóa 18', 'Chưa học'],
                        datasets: [{
                            data: [500, 4500, 250, 23050],
                            backgroundColor: [
                                'rgba(255, 193, 7, 0.8)',
                                'rgba(40, 167, 69, 0.8)',
                                'rgba(102, 126, 234, 0.8)',
                                'rgba(220, 53, 69, 0.8)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Tỷ lệ hoàn thành năm 2024-2025'
                            }
                        }
                    }
                });
            }
            
            // Forecast chart
            const ctx3 = document.getElementById('forecastChart');
            if (ctx3) {
                new Chart(ctx3, {
                    type: 'line',
                    data: {
                        labels: ['2024-2025', '2025-2026', '2026-2027', '2027-2028', '2028-2029'],
                        datasets: [{
                            label: 'Số đợt cần thiết',
                            data: [13, 14, 15, 12, 10],
                            borderColor: 'rgba(102, 126, 234, 1)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Dự báo số đợt học cần thiết theo năm'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }
        
       // function initTrendChart() {
            const ctx = document.getElementById('trendChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['2022-2023', '2023-2024', '2024-2025', '2025-2026', '2026-2027'],
                        datasets: [{
                            label: 'Tổng SV hoàn thành/năm',
                            data: [1200, 2200, 3873, 4400, 5650],
                            borderColor: 'rgba(102, 126, 234, 1)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Xu hướng tăng trưởng số sinh viên hoàn thành'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
     //   }
// biểu đồ chồng
// Load stacked chart function
//       function loadChart() {
            const ctx4 = document.getElementById('gdqpChart');
            try {
                // Since we can't load external files, we'll use sample data
                const data = {
                    labels: ['2022-2023', '2023-2024', '2024-2025', '2025-2026', '2026-2027', '2027-2028'],
                    datasets: [
                        {
                            label: 'Khóa 14',
                            data: [791, 792, 237, 0, 0, 0],
                            color: '#3B82F6'
                        },
                        {
                            label: 'Khóa 15',
                            data: [1225, 1225, 0, 0, 0, 0],
                            color: '#10B981'
                        },
                        {
                            label: 'Khóa 16',
                            data: [1500, 546, 954, 0, 0, 0],
                            color: '#F59E0B'
                        },
                        {
                            label: 'Khóa 17',
                            data: [0, 1500, 2682, 454, 0, 0],
                            color: '#EF4444'
                        },
                        {
                            label: 'Khóa 18',
                            data: [0, 0, 164, 2850, 3000, 0],
                            color: '#8B5CF6'
                        },
                        // từ k18 tức 2025-2026 số sinh. phải học sẽ là 600 sinh viên up
                        {
                            label: 'Khóa 19',
                            data: [0, 0, 0, 1034, 1333, 1333],
                            color: '#06B6D4'
                        },
                        {
                            label: 'Khóa 20',
                            data: [0, 0, 0, 0, 1334, 1333],
                            color: '#84CC16'
                        }
                    ]
                };

                const ctx4 = document.getElementById('gdqpChart').getContext('2d');
                new Chart(ctx4, {
                    type: 'bar',
                    data: {
                        labels: data.labels,
                        datasets: data.datasets.map(ds => ({
                            label: ds.label,
                            data: ds.data,
                            backgroundColor: ds.color,
                            borderWidth: 1
                        }))
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                position: 'right', 
                                labels: { color: '#000000' } 
                            },
                            title: { 
                                display: true, 
                                text: 'Sinh viên hoàn thành GDQP theo năm & khóa', 
                                color: '#0000000', 
                                font: { size: 20 } 
                            }
                        },
                        scales: {
                            x: { 
                                stacked: true, 
                                ticks: { color: '#808080' },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }
                            },
                            y: { 
                                stacked: true, 
                                ticks: { color: '#808080' },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }
                            }
                        }
                    }
                });
            } catch (err) {
                console.error("Không thể tải dữ liệu biểu đồ:", err);
            }
//        }

        
        // Data for filtering and export
        const studentData = {
            '16': {
                total: 3000,
                graduated: {
                    '2022-2023': 1200,
                    '2023-2024': 1400,
                    '2024-2025': 500,
                    '2025-2026': 0,
                    '2026-2027': 0
                }
            },
            '17': {
                total: 5300,
                graduated: {
                    '2022-2023': 0,
                    '2023-2024': 800,
                    '2024-2025': 4500,
                    '2025-2026': 0,
                    '2026-2027': 0
                }
            },
            '18': {
                total: 6000,
                graduated: {
                    '2022-2023': 0,
                    '2023-2024': 0,
                    '2024-2025': 250,
                    '2025-2026': 4800,
                    '2026-2027': 950
                }
            },
            '19': {
                total: 7000,
                graduated: {
                    '2022-2023': 0,
                    '2023-2024': 0,
                    '2024-2025': 0,
                    '2025-2026': 3500,
                    '2026-2027': 3500
                }
            },
            '20': {
                total: 7000,
                graduated: {
                    '2022-2023': 0,
                    '2023-2024': 0,
                    '2024-2025': 0,
                    '2025-2026': 0,
                    '2026-2027': 4200
                }
            }
        };
        
        let filteredData = [];
        
        function applyFilter() {
            const courseSelect = document.getElementById('courseSelect').value;
            const yearSelect = document.getElementById('yearSelect').value;
            const resultsDiv = document.getElementById('filterResults');
            
            filteredData = [];
            
            if (!courseSelect && !yearSelect) {
                resultsDiv.innerHTML = '<p class="no-data">Vui lòng chọn ít nhất một điều kiện lọc.</p>';
                return;
            }
            
            // Filter data based on selection
            for (let course in studentData) {
                if (courseSelect && course !== courseSelect) continue;
                
                for (let year in studentData[course].graduated) {
                    if (yearSelect && year !== yearSelect) continue;
                    
                    const graduatedCount = studentData[course].graduated[year];
                    if (graduatedCount > 0) {
                        filteredData.push({
                            course: `Khóa ${course}`,
                            year: year,
                            total: studentData[course].total,
                            graduated: graduatedCount,
                            remaining: studentData[course].total - Object.values(studentData[course].graduated).reduce((a, b) => a + b, 0)
                        });
                    }
                }
            }
            
            displayFilterResults();
        }
        
        function displayFilterResults() {
            const resultsDiv = document.getElementById('filterResults');
            
            if (filteredData.length === 0) {
                resultsDiv.innerHTML = '<p class="no-data">Không có dữ liệu phù hợp với điều kiện lọc.</p>';
                return;
            }
            
            // Calculate summary
            const totalGraduated = filteredData.reduce((sum, item) => sum + item.graduated, 0);
            const uniqueCourses = [...new Set(filteredData.map(item => item.course))];
            const uniqueYears = [...new Set(filteredData.map(item => item.year))];
            
            let html = `
                <div class="result-summary">
                    <h4>📊 Tóm tắt kết quả lọc</h4>
                    <div class="summary-stats">
                        <div class="summary-item">
                            <div class="summary-number">${filteredData.length}</div>
                            <div class="summary-label">Bản ghi</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number">${uniqueCourses.length}</div>
                            <div class="summary-label">Khóa học</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number">${uniqueYears.length}</div>
                            <div class="summary-label">Năm học</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number">${totalGraduated.toLocaleString()}</div>
                            <div class="summary-label">Tổng SV ra trường</div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Khóa học</th>
                                <th>Năm học</th>
                                <th>Tổng số SV khóa</th>
                                <th>SV ra trường năm đó</th>
                                <th>Tỷ lệ (%)</th>
                                <th>SV còn lại</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            filteredData.forEach((item, index) => {
                const percentage = ((item.graduated / item.total) * 100).toFixed(1);
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${item.course}</strong></td>
                        <td>${item.year}</td>
                        <td>${item.total.toLocaleString()}</td>
                        <td>${item.graduated.toLocaleString()}</td>
                        <td>${percentage}%</td>
                        <td>${Math.max(0, item.remaining).toLocaleString()}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }
        
        function exportToExcel() {
            if (filteredData.length === 0) {
                alert('Vui lòng lọc dữ liệu trước khi xuất Excel!');
                return;
            }
            
            // Prepare data for Excel
            const excelData = filteredData.map((item, index) => ({
                'STT': index + 1,
                'Khóa học': item.course,
                'Năm học': item.year,
                'Tổng số SV khóa': item.total,
                'SV ra trường năm đó': item.graduated,
                'Tỷ lệ (%)': ((item.graduated / item.total) * 100).toFixed(1) + '%',
                'SV còn lại': Math.max(0, item.remaining)
            }));
            
            // Add summary row
            const totalGraduated = filteredData.reduce((sum, item) => sum + item.graduated, 0);
            excelData.push({
                'STT': '',
                'Khóa học': 'TỔNG CỘNG',
                'Năm học': '',
                'Tổng số SV khóa': '',
                'SV ra trường năm đó': totalGraduated,
                'Tỷ lệ (%)': '',
                'SV còn lại': ''
            });
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // Set column widths
            ws['!cols'] = [
                { width: 5 },   // STT
                { width: 12 },  // Khóa học
                { width: 15 },  // Năm học
                { width: 18 },  // Tổng số SV
                { width: 20 },  // SV ra trường
                { width: 12 },  // Tỷ lệ
                { width: 15 }   // SV còn lại
            ];
            
            XLSX.utils.book_append_sheet(wb, ws, 'Thống kê GDQP');
            
            // Generate filename
            const courseSelect = document.getElementById('courseSelect').value;
            const yearSelect = document.getElementById('yearSelect').value;
            let filename = 'Thong_ke_GDQP';
            if (courseSelect) filename += `_Khoa${courseSelect}`;
            if (yearSelect) filename += `_${yearSelect.replace('-', '_')}`;
            filename += `_${new Date().toISOString().slice(0, 10)}.xlsx`;
            
            // Save file
            XLSX.writeFile(wb, filename);
            
            // Show success message
            alert(`Đã xuất thành công file Excel: ${filename}`);
        }
        
        function exportOverviewToExcel() {
            // Prepare overview data for Excel
            const overviewData = [
                {
                    'Khóa': 'Khóa 16',
                    'Tổng số SV': 3000,
                    'SV hoàn thành 2024-2025': '400-600',
                    'Tỷ lệ hoàn thành': '13-20%',
                    'Trạng thái': 'Gần hoàn thành'
                },
                {
                    'Khóa': 'Khóa 17',
                    'Tổng số SV': 5300,
                    'SV hoàn thành 2024-2025': '3,800-5,700',
                    'Tỷ lệ hoàn thành': '72-100%',
                    'Trạng thái': 'Đang học chính'
                },
                {
                    'Khóa': 'Khóa 18',
                    'Tổng số SV': 6000,
                    'SV hoàn thành 2024-2025': '200-300',
                    'Tỷ lệ hoàn thành': '3-5%',
                    'Trạng thái': 'Mới bắt đầu'
                },
                {
                    'Khóa': 'Khóa 19',
                    'Tổng số SV': '6,000-8,000',
                    'SV hoàn thành 2024-2025': '0',
                    'Tỷ lệ hoàn thành': '0%',
                    'Trạng thái': 'Sắp nhập học'
                },
                {
                    'Khóa': 'Khóa 20',
                    'Tổng số SV': '6,000-8,000',
                    'SV hoàn thành 2024-2025': '0',
                    'Tỷ lệ hoàn thành': '0%',
                    'Trạng thái': 'Sắp nhập học'
                }
            ];
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(overviewData);
            
            // Set column widths
            ws['!cols'] = [
                { width: 12 },  // Khóa
                { width: 15 },  // Tổng số SV
                { width: 25 },  // SV hoàn thành
                { width: 18 },  // Tỷ lệ
                { width: 20 }   // Trạng thái
            ];
            
            XLSX.utils.book_append_sheet(wb, ws, 'Tổng quan các khóa');
            
            // Generate filename
            const filename = `Tong_quan_sinh_vien_cac_khoa_${new Date().toISOString().slice(0, 10)}.xlsx`;
            
            // Save file
            XLSX.writeFile(wb, filename);
            
            // Show success message
            alert(`Đã xuất thành công file Excel: ${filename}`);
        }
        
        function exportStatisticsToExcel() {
            // Prepare statistics data for Excel
            const statisticsData = [
                {
                    'Khóa': 'Khóa 16',
                    '2022-2023': 1200,
                    '2023-2024': 1400,
                    '2024-2025': 500,
                    '2025-2026': 0,
                    '2026-2027': 0,
                    'Tổng': 3000
                },
                {
                    'Khóa': 'Khóa 17',
                    '2022-2023': 0,
                    '2023-2024': 800,
                    '2024-2025': 4500,
                    '2025-2026': 0,
                    '2026-2027': 0,
                    'Tổng': 5300
                },
                {
                    'Khóa': 'Khóa 18',
                    '2022-2023': 0,
                    '2023-2024': 0,
                    '2024-2025': 250,
                    '2025-2026': 4800,
                    '2026-2027': 950,
                    'Tổng': 6000
                },
                {
                    'Khóa': 'Khóa 19',
                    '2022-2023': 0,
                    '2023-2024': 0,
                    '2024-2025': 0,
                    '2025-2026': 3500,
                    '2026-2027': 3500,
                    'Tổng': 7000
                },
                {
                    'Khóa': 'Khóa 20',
                    '2022-2023': 0,
                    '2023-2024': 0,
                    '2024-2025': 0,
                    '2025-2026': 0,
                    '2026-2027': 4200,
                    'Tổng': 7000
                },
                {
                    'Khóa': 'TỔNG/NĂM',
                    '2022-2023': 1200,
                    '2023-2024': 2200,
                    '2024-2025': 5250,
                    '2025-2026': 8300,
                    '2026-2027': 8650,
                    'Tổng': 28300
                }
            ];
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(statisticsData);
            
            // Set column widths
            ws['!cols'] = [
                { width: 15 },  // Khóa
                { width: 12 },  // 2022-2023
                { width: 12 },  // 2023-2024
                { width: 12 },  // 2024-2025
                { width: 12 },  // 2025-2026
                { width: 12 },  // 2026-2027
                { width: 12 }   // Tổng
            ];
            
            XLSX.utils.book_append_sheet(wb, ws, 'Thống kê theo năm');
            
            // Generate filename
            const filename = `Thong_ke_sinh_vien_theo_nam_${new Date().toISOString().slice(0, 10)}.xlsx`;
            
            // Save file
            XLSX.writeFile(wb, filename);
            
            // Show success message
            alert(`Đã xuất thành công file Excel: ${filename}`);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Add some interactive effects
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-10px) scale(1.02)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96fb6ac1a329e6c6',t:'MTc1NTI4OTQ4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>




  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // khi bấm tab biểu đồ -> load chart
            if (tabName === 'charts'){
                setTimeout(initCharts, 100);
            }
        }
        
        // Course data
        const courseData = {
            '16': { total: 3000, completed: 2500, remaining: 500 },
            '17': { total: 5300, completed: 4800, remaining: 500 },
            '18': { total: 6000, completed: 250, remaining: 5750 },
            '19': { total: 7000, completed: 0, remaining: 7000 },
            '20': { total: 7000, completed: 0, remaining: 7000 }
        };
        
        let generatedSchedule = [];
        
        // Calculate batches
        function calculateBatches() {
            const totalStudents = parseInt(document.getElementById('totalStudents').value);
            const studentsPerBatch = parseInt(document.getElementById('studentsPerBatch').value);
            const weeksPerBatch = parseInt(document.getElementById('weeksPerBatch').value);
            const weeksPerYear = parseInt(document.getElementById('weeksPerYear').value);
            
            const totalBatches = Math.ceil(totalStudents / studentsPerBatch);
            const batchesPerYear = Math.floor(weeksPerYear / weeksPerBatch);
            const yearsNeeded = Math.ceil(totalBatches / batchesPerYear);
            const totalWeeksNeeded = totalBatches * weeksPerBatch;
            
            const resultDiv = document.getElementById('calculationResult');
            resultDiv.innerHTML = `
                <div class="result-box">
                    <h4>📊 Kết quả tính toán:</h4>
                    <p>• Tổng số đợt cần thiết: <span class="highlight">${totalBatches} đợt</span></p>
                    <p>• Số đợt có thể tổ chức/năm: <span class="highlight">${batchesPerYear} đợt</span></p>
                    <p>• Số năm học cần thiết: <span class="highlight">${yearsNeeded} năm</span></p>
                    <p>• Tổng số tuần giảng dạy: <span class="highlight">${totalWeeksNeeded} tuần</span></p>
                    <p>• Sinh viên thực tế được đào tạo: <span class="highlight">${totalBatches * studentsPerBatch} sinh viên</span></p>
                </div>
            `;
            
            if (totalBatches * studentsPerBatch > totalStudents) {
                resultDiv.innerHTML += `
                    <div class="warning">
                        ⚠️ Lưu ý: Sẽ có ${totalBatches * studentsPerBatch - totalStudents} chỗ trống trong đợt cuối
                    </div>
                `;
            }
        }
        
        // Calculate for specific course
        function calculateCourse() {
            const courseId = document.getElementById('CourseSelect').value;
            const priority = parseInt(document.getElementById('priority').value);
            const studentsPerBatch = parseInt(document.getElementById('studentsPerBatch').value) || 600;
            const weeksPerBatch = parseInt(document.getElementById('weeksPerBatch').value) || 3;
            
            const course = courseData[courseId];
            const batchesNeeded = Math.ceil(course.remaining / studentsPerBatch);
            const weeksNeeded = batchesNeeded * weeksPerBatch;
            
            const resultDiv = document.getElementById('courseResult');
            resultDiv.innerHTML = `
                <div class="result-box">
                    <h4>🎯 Kết quả cho Khóa ${courseId}:</h4>
                    <p>• Sinh viên còn lại: <span class="highlight">${course.remaining.toLocaleString()}</span></p>
                    <p>• Số đợt cần thiết: <span class="highlight">${batchesNeeded} đợt</span></p>
                    <p>• Số tuần giảng dạy: <span class="highlight">${weeksNeeded} tuần</span></p>
                    <p>• Mức độ ưu tiên: <span class="highlight">${priority}/5</span></p>
                    <p>• Thời gian hoàn thành dự kiến: <span class="highlight">${Math.ceil(weeksNeeded / 38)} năm học</span></p>
                </div>
            `;
        }
        
        // Calculate date ranges for academic weeks
        function getAcademicWeekDates(year, weekNumber) {
            // Academic year starts in late August (week 35 of calendar year)
            const academicYearStart = new Date(year, 7, 20); // August 20th
            const startDate = new Date(academicYearStart);
            startDate.setDate(startDate.getDate() + (weekNumber - 1) * 7);
            
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 6);
            
            const formatDate = (date) => {
                return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
            };
            
            return {
                start: formatDate(startDate),
                end: formatDate(endDate)
            };
        }
        
        // Generate schedule
        function generateSchedule() {
            const startYear = parseInt(document.getElementById('startYear').value);
            const maxBatchesPerYear = parseInt(document.getElementById('maxBatchesPerYear').value);
            const strategy = document.getElementById('strategy').value;
            const studentsPerBatch = 600;
            const weeksPerBatch = 3;
            
            generatedSchedule = [];
            let currentYear = startYear;
            let batchesThisYear = 0;
            let batchNumber = 1;
            
            // Create priority queue based on strategy
            let courseQueue = [];
            if (strategy === 'priority') {
                courseQueue = ['16', '17', '18', '19', '20'];
            } else if (strategy === 'balanced') {
                courseQueue = ['16', '17', '18', '19', '20'];
            } else {
                courseQueue = ['16', '17', '18', '19', '20'];
            }
            
            // Generate schedule for each course
            courseQueue.forEach(courseId => {
                const course = courseData[courseId];
                let remaining = course.remaining;
                
                while (remaining > 0) {
                    if (batchesThisYear >= maxBatchesPerYear) {
                        currentYear++;
                        batchesThisYear = 0;
                    }
                    
                    const studentsInBatch = Math.min(remaining, studentsPerBatch);
                    const startWeek = (batchesThisYear * weeksPerBatch) + 1;
                    const endWeek = startWeek + weeksPerBatch - 1;
                    
                    // Calculate actual dates
                    const startDates = getAcademicWeekDates(currentYear, startWeek);
                    const endDates = getAcademicWeekDates(currentYear, endWeek);
                    
                    generatedSchedule.push({
                        batch: batchNumber,
                        year: `${currentYear}-${currentYear + 1}`,
                        course: `Khóa ${courseId}`,
                        students: studentsInBatch,
                        weeks: `Tuần ${startWeek}-${endWeek}`,
                        startWeek: startWeek,
                        endWeek: endWeek,
                        dateRange: `${startDates.start} - ${endDates.end}`,
                        startDate: startDates.start,
                        endDate: endDates.end
                    });
                    
                    remaining -= studentsInBatch;
                    batchesThisYear++;
                    batchNumber++;
                }
            });
            
            displaySchedule();
        }
        
        // Display generated schedule
        function displaySchedule() {
            const resultDiv = document.getElementById('scheduleResult');
            
            if (generatedSchedule.length === 0) {
                resultDiv.innerHTML = '<p>Chưa có lịch học nào được tạo.</p>';
                return;
            }
            
            // Group by year
            const scheduleByYear = {};
            generatedSchedule.forEach(item => {
                if (!scheduleByYear[item.year]) {
                    scheduleByYear[item.year] = [];
                }
                scheduleByYear[item.year].push(item);
            });
            
            let html = '<div class="result-box"><h4>📅 Lịch học được tạo:</h4>';
            html += `<p>• Tổng số đợt: <span class="highlight">${generatedSchedule.length} đợt</span></p>`;
            html += `<p>• Số năm học: <span class="highlight">${Object.keys(scheduleByYear).length} năm</span></p></div>`;
            
            Object.keys(scheduleByYear).forEach(year => {
                html += `<div class="schedule-item">`;
                html += `<h5>📚 Năm học ${year} (${scheduleByYear[year].length} đợt)</h5>`;
                html += `<div class="table-container"><table>`;
                html += `<thead><tr><th>Đợt</th><th>Khóa</th><th>SV</th><th>Tuần học</th><th>Thời gian cụ thể</th></tr></thead><tbody>`;
                
                scheduleByYear[year].forEach(batch => {
                    html += `<tr>`;
                    html += `<td>Đợt ${batch.batch}</td>`;
                    html += `<td>${batch.course}</td>`;
                    html += `<td>${batch.students}</td>`;
                    html += `<td>${batch.weeks}</td>`;
                    html += `<td><strong>${batch.dateRange}</strong></td>`;
                    html += `</tr>`;
                });
                
                html += `</tbody></table></div></div>`;
            });
            
            resultDiv.innerHTML = html;
        }
        
        // Export schedule to Excel
        function exportSchedule() {
            if (generatedSchedule.length === 0) {
                alert('Vui lòng tạo lịch học trước khi xuất Excel!');
                return;
            }
            
            const excelData = generatedSchedule.map(item => ({
                'Đợt': `Đợt ${item.batch}`,
                'Năm học': item.year,
                'Khóa': item.course,
                'Số sinh viên': item.students,
                'Tuần học': item.weeks,
                'Thời gian cụ thể': item.dateRange,
                'Ngày bắt đầu': item.startDate,
                'Ngày kết thúc': item.endDate
            }));
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            ws['!cols'] = [
                { width: 10 }, { width: 15 }, { width: 12 }, 
                { width: 15 }, { width: 15 }, { width: 20 }, { width: 15 }, { width: 15 }
            ];
            
            XLSX.utils.book_append_sheet(wb, ws, 'Lịch học GDQP');
            
            const filename = `Lich_hoc_GDQP_${new Date().toISOString().slice(0, 10)}.xlsx`;
            XLSX.writeFile(wb, filename);
            
            alert(`Đã xuất thành công: ${filename}`);
        }
        
        // Export summary
        function exportSummary() {
            const totalRemaining = Object.values(courseData).reduce((sum, course) => sum + course.remaining, 0);
            const totalBatches = Math.ceil(totalRemaining / 600);
            
            const summaryData = [
                { 'Thông tin': 'Tổng sinh viên còn lại', 'Giá trị': totalRemaining },
                { 'Thông tin': 'Tổng số đợt cần thiết', 'Giá trị': totalBatches },
                { 'Thông tin': 'Số năm học dự kiến', 'Giá trị': Math.ceil(totalBatches / 12) },
                { 'Thông tin': 'Tổng tuần giảng dạy', 'Giá trị': totalBatches * 3 }
            ];
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(summaryData);
            
            XLSX.utils.book_append_sheet(wb, ws, 'Tóm tắt');
            
            const filename = `Tom_tat_GDQP_${new Date().toISOString().slice(0, 10)}.xlsx`;
            XLSX.writeFile(wb, filename);
            
            alert(`Đã xuất tóm tắt: ${filename}`);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            calculateBatches();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'972fb6ef01010495',t:'MTc1NTgzNzg2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>


</body>
</html>
